# Firebase Setup Guide for MarketNews App

## Overview
This guide will help you migrate your MarketNews app from a local Python backend to Firebase Cloud Functions with hosting.

## Prerequisites
1. Node.js (v18 or later)
2. Firebase CLI
3. A Firebase project (create one at https://console.firebase.google.com)

## Step-by-Step Setup

### 1. Install Firebase CLI
```bash
npm install -g firebase-tools
```

### 2. Login to Firebase
```bash
firebase login
```

### 3. Initialize Firebase in Your Project
Navigate to the `firebase` directory and run:
```bash
cd firebase
firebase init
```

**Select the following options:**
- ✅ Functions: Configure a Cloud Functions directory and its files
- ✅ Hosting: Configure files for Firebase Hosting and (optionally) set up GitHub Action deploys
- Choose your Firebase project
- Use TypeScript for Cloud Functions
- Use ESLint: Yes
- Install dependencies: Yes
- Public directory: `../market_news_app/build/web`
- Configure as single-page app: Yes
- Set up automatic builds and deploys with GitHub: No (for now)

### 4. Install Function Dependencies
```bash
cd functions
npm install
```

### 5. Configure Flutter Firebase
Navigate back to your Flutter app directory:
```bash
cd ../../market_news_app
```

Install FlutterFire CLI:
```bash
dart pub global activate flutterfire_cli
```

Configure Firebase for Flutter:
```bash
flutterfire configure
```

This will:
- Generate `firebase_options.dart`
- Configure your app for all platforms
- Link your Flutter app to your Firebase project

### 6. Update Flutter Dependencies
```bash
flutter pub get
```

### 7. Uncomment Firebase Initialization
After running `flutterfire configure`, uncomment the Firebase initialization code in `lib/main.dart`:

```dart
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart';

// In main() function:
await Firebase.initializeApp(
  options: DefaultFirebaseOptions.currentPlatform,
);
```

### 8. Set Environment Variables for Cloud Functions
Set your FMP API key as an environment variable:
```bash
cd ../firebase/functions
firebase functions:config:set fmp.api_key="YOUR_FMP_API_KEY_HERE"
```

### 9. Update Flutter App to Use Firebase Functions
Update your Flutter app to call Firebase Functions instead of localhost:

In your Flutter service files, change:
```dart
// Old
final response = await http.get(Uri.parse('http://localhost:5000/report.json'));

// New
final response = await http.get(Uri.parse('https://YOUR_REGION-YOUR_PROJECT_ID.cloudfunctions.net/api/report.json'));
```

### 10. Build and Deploy

#### Build Flutter Web App:
```bash
cd market_news_app
flutter build web
```

#### Deploy Firebase Functions and Hosting:
```bash
cd ../firebase
firebase deploy
```

## Project Structure After Setup

```
MarketNews/
├── firebase/
│   ├── functions/
│   │   ├── src/
│   │   │   └── index.ts          # Main Cloud Function
│   │   ├── package.json
│   │   └── tsconfig.json
│   ├── firebase.json
│   └── .firebaserc
├── market_news_app/
│   ├── lib/
│   │   ├── firebase_options.dart  # Generated by flutterfire configure
│   │   └── main.dart              # Updated with Firebase init
│   └── build/web/                 # Built Flutter web app
└── FIREBASE_SETUP.md
```

## Environment Variables Setup

Your Cloud Function will need the following environment variables:

```bash
# Set FMP API Key
firebase functions:config:set fmp.api_key="YOUR_FMP_API_KEY"

# Deploy to apply changes
firebase deploy --only functions
```

## Testing Locally

### 1. Start Firebase Emulators:
```bash
cd firebase
firebase emulators:start
```

### 2. Update Flutter App for Local Testing:
```dart
// For local testing, use emulator URL
final response = await http.get(Uri.parse('http://localhost:5001/YOUR_PROJECT_ID/us-central1/api/report.json'));
```

### 3. Test Your App:
```bash
cd ../market_news_app
flutter run -d web-server --web-hostname localhost --web-port 8080
```

## Production URLs

After deployment, your APIs will be available at:
- **Functions**: `https://YOUR_REGION-YOUR_PROJECT_ID.cloudfunctions.net/api/`
- **Hosting**: `https://YOUR_PROJECT_ID.web.app` or your custom domain

## API Endpoints

Your Firebase Cloud Function provides these endpoints:

- `GET /report.json` - Main market report data
- `GET /news.json` - News data
- `GET /health` - Health check

## Next Steps

1. **Complete the setup** following this guide
2. **Test locally** using Firebase emulators
3. **Deploy to production** when ready
4. **Update Flutter app** to use production URLs
5. **Implement Phase 1.1 features** from the roadmap (IV Rank integration)

## Troubleshooting

### Common Issues:

1. **Firebase CLI not found**: Install with `npm install -g firebase-tools`
2. **FlutterFire CLI not found**: Install with `dart pub global activate flutterfire_cli`
3. **Permission errors**: Make sure you're logged in with `firebase login`
4. **Function deployment fails**: Check that all dependencies are installed in `functions/`
5. **CORS issues**: The Cloud Function includes CORS headers for web access

### Useful Commands:

```bash
# View function logs
firebase functions:log

# View current config
firebase functions:config:get

# Redeploy only functions
firebase deploy --only functions

# Redeploy only hosting
firebase deploy --only hosting
```

## Security Notes

1. **API Keys**: Never expose API keys in client-side code
2. **Environment Variables**: Use Firebase Functions config for sensitive data
3. **CORS**: The function is configured to allow all origins - restrict in production
4. **Authentication**: Consider adding Firebase Auth for user-specific features

## Cost Considerations

- **Cloud Functions**: Pay per invocation and execution time
- **Hosting**: Free tier includes 10GB storage and 10GB/month transfer
- **Firestore**: Pay per read/write if you add database features later

The current setup should fit well within Firebase's free tier for development and moderate production use. 