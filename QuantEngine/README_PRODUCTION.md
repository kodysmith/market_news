# QuantEngine Production Mode

## Overview

QuantEngine can run in production mode to send real-time data to the production database (Firestore) instead of using local SQLite storage.

## Production Mode Setup

### Environment Variables

Set the production environment variable:

```bash
export QUANT_ENV=production
# or
export QUANT_ENV=prod
# or
export QUANT_ENV=live
```

### Firebase Setup

For production mode, QuantEngine requires Firebase/Firestore access:

1. **Install Firebase Admin SDK**:
   ```bash
   pip install firebase-admin
   ```

2. **Service Account Key** (for production):
   - Download your Firebase service account key JSON file
   - Set `GOOGLE_APPLICATION_CREDENTIALS` environment variable:
   ```bash
   export GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account-key.json"
   ```

   OR initialize Firebase in your application code.

### Running in Production

Use the production runner script:

```bash
python run_quantengine_production.py
```

This automatically sets `QUANT_ENV=production` and configures production logging.

## What Gets Saved to Production Database

When running in production mode, QuantEngine saves:

### Trading Opportunities
- Approved strategies from research cycles
- Strategy metadata (Sharpe ratio, expected returns, etc.)
- Saved to Firestore collection: `opportunities`

### Market Analysis
- Real-time market sentiment analysis
- Economic indicators and regime detection
- Saved to Firestore collection: `market_analysis`

### Trading Signals
- Live trading signals generated by strategies
- Signal strength and confidence scores
- Saved to Firestore collection: `trading_signals`

### Performance Metrics
- Strategy performance tracking
- Risk metrics and drawdown analysis
- Saved to Firestore collection: `performance_metrics`

## Database Schema

### Opportunities Collection
```javascript
{
  id: "strategy_momentum_v1_1640995200",
  symbol: "MULTI-ASSET",
  strategy: "momentum_v1",
  direction: "neutral",
  expected_return: 0.15,
  expected_volatility: 0.12,
  confidence: 0.85,
  timeframe: "daily",
  regime: "all_market_conditions",
  signal_strength: 1.8, // Sharpe ratio
  risk_reward_ratio: 2.0,
  rank: 1,
  timestamp: 1640995200000,
  created_at: FirestoreTimestamp,
  updated_at: FirestoreTimestamp
}
```

## Monitoring Production Data

### Firebase Console
- Go to [Firebase Console](https://console.firebase.google.com)
- Navigate to Firestore Database
- View collections: `opportunities`, `market_analysis`, `trading_signals`, `performance_metrics`

### API Access
The production data is accessible via the Flutter app API endpoints, which read from Firestore in production mode.

## Switching Between Development and Production

### Development Mode (Default)
```bash
# No environment variables needed
python main.py research  # Uses SQLite database
```

### Production Mode
```bash
export QUANT_ENV=production
python main.py research  # Uses Firestore database

# OR use the production runner
python run_quantengine_production.py
```

## Troubleshooting

### Firebase Connection Issues
- Verify `GOOGLE_APPLICATION_CREDENTIALS` is set correctly
- Check Firebase project permissions
- Ensure Firestore is enabled in Firebase Console

### Data Not Appearing
- Check QuantEngine logs for database save confirmations
- Verify Firestore security rules allow writes
- Confirm `QUANT_ENV` environment variable is set

### Performance Impact
- Firestore writes are asynchronous and shouldn't impact strategy performance
- Monitor Firebase usage costs for high-frequency data
- Consider batching writes for better performance

## Production Checklist

- [ ] `QUANT_ENV=production` environment variable set
- [ ] Firebase Admin SDK installed (`pip install firebase-admin`)
- [ ] Service account key configured (`GOOGLE_APPLICATION_CREDENTIALS`)
- [ ] Firestore security rules allow QuantEngine writes
- [ ] Firebase project has proper permissions
- [ ] Test with small dataset first
- [ ] Monitor Firebase usage and costs
